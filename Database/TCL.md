<div align="center">
  <br />
  <h1>TCL</h1>
  <br />
</div>

## 목차

1. [**TCL 이란?**](#1)
2. [**TCL 종류**](#2)
3. [**COMMIT**](#3)
4. [**ROLLBACK**](#4)
5. [**SAVEPOINT**](#5)

<br />

<div id="1"></div>

## TCL 이란?

TRANSACTION CONTROL LANGUAGE 로 트랜잭션을 제어하는 언어입니다.

DCL(Data Control Language)에서 트랜잭션을 제어하는 명령만을 따로 분리해서 TCL이라고 한다.

<br />

<div id="2"></div>

## TCL 종류

![image](https://user-images.githubusercontent.com/56222478/168571424-fbd9ee5c-eafd-4ead-af00-fe1f4dd76039.png)

<br />

<div id="3"></div>

## COMMIT

COMMIT 연산은 트랜잭션 처리가 정상적으로 종료되어 트랜잭션이 수행한 변경 내용을 데이터베이스에 반영하는 연산입니다.

```sql
COMMIT;
```

### COMMIT 이전의 데이터 상태는 다음과 같습니다.

1. 메모리 버퍼에만 영향을 받았기 때문에 데이터의 변경 이전 상태로 복구가 가능합니다.

2. 현재 사용자는 SELECT 문장으로 결과를 확인 가능합니다.

3. 다른 사용자는 현재 사용자가 수행한 명령의 결과를 볼 수 없습니다.

4. 변경된 행은 잠금이 설정되어서 다른 사용자가 변경할 수 없습니다.

### COMMIT 이후의 상태는 다음과 같습니다.

1. 데이터에 대한 변경 사항이 데이터베이스에 반영됩니다.

2. 이전 데이터는 영원히 잃어버리게 됩니다.

3. 모든 사용자는 결과를 볼 수 있습니다.

4. 관련된 행에 대한 잠금이 풀리고, 다른 사용자들이 행을 조작할 수 있습니다.

<br />

<div id="4"></div>

## ROLLBACK

ROLLBACK 연산은 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성이 깨졌을 때, 트랜잭션이 행한 모든 변경 작업을 취소하고 Commit 되기 이전 상태로 되돌리는 연산입니다.

ROLLBACK 연산 시 해당 트랜잭션은 받았던 자원과 잠금(LOCK)을 모두 반환하고, 재시작(Restart)되든지 폐기됩니다.

```sql
ROLLBACK;
```

ROLLBACK 이후의 상태는 다음과 같습니다.

1. 데이터에 대한 변경 사항은 취소됩니다.

2. 이전 데이터는 다시 재저장됩니다.

3. 관련된 행에 대한 잠금이 풀리고, 다른 사용자들이 행을 조작할 수 있게 됩니다.

<br />

<div id="5"></div>

## SAVEPOINT
저장점을 정의하면 롤백할 때 트랜잭션에 포함된 전체 작업을 롤백하는 것이 아니라 현 시점에서 SAVEPOINT 까지 트랜잭션의 일부만 롤백할 수 있습니다.

복수의 저장점을 정의할 수 있으며, 동일이름으로 저장점을 정의했을 때는 나중에 정의한 저장점이 유효합니다.

ORACLE 의 경우 아래와 같이 수행합니다.

```sql
SAVEPOINT 포인트명1;
SAVEPOINT 포인트명2;
ROLLBACK TO 포인트명1;
```

특정 저장점까지 ROLLBACK 하면 그 저장점 이후에 설정한 저장점이 무효가 되기 때문에 위에서의 경우 포인트명1 로 ROLLBACK 한 경우 포인트명2 로 되돌릴 수 없습니다.

저장점 지정 없이 ROLLBACK 을 실행했을 경우 모든 변경사항을 취소합니다.

### SAVEPOINT 유의사항

SAVEPOINT 정의 후 COMMIT연산을 하게 된다면, COMMIT 연산 이전에 만든 SAVEPOINT들은 모두 사라지게 됩니다.
