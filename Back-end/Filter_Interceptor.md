<div align="center">
  <br />
  <h1> 필터와 인터셉터의 개념과 차이</h1>
  <br />
</div>

## 목차

1. [**필터(Filter)**](#1)
2. [**인터셉터(Intercepter)**](#2)
3. [**필터와 인터셉터 차이**](#3)
4. [**필터와 인터셉터 사용 사례**](#4)

<br />

<div id="1"></div>

## 필터(Filter)

요청과 응답을 거른 뒤 정제하는 역할

Dispatcher Servlet에 요청이 전될 되기 전 / 후 로 url 패턴에 맞는 모든 요청에 대해 부가 작업을 처리할 수 있는 기능을 제공한다.
스프링 컨테이너가 아닌 톰캣 과 같은 웹 컨테이너에 의해 관리가 되는 것이고, 스프링 범위 밖에서 처리된다.(스프링 빈으로 등록 가능하다.)

<img src="./images/Filter.png" alt="Filter" />

필터를 사용하기 위해서는 Filter 인터페이스를 구현해야하며, 사용하기 위해서는 다음과 같은 메소드가 필요하다.

1. init()
   - 필터 객체를 초기화 하고 서비스에 추가하기 위한 메소드. 웹 컨테이너가 1회 init()을 호출하여 필터 객체를 초기화 하면 이후 요청들은 doFilter()를 통해 처리
2. doFilter()
    - url-pattern에 맞는 모든 HTTP 요청이 Dispatcher Servlet으로 전달되기 전에 웹 컨테이너에 의해 실행되는 메소드. 파라미터로는 FilterChain이 있는데, 다음 대상으로 요청할 수 있게 된다. chain.doFilter()로 전, 후에 우리가 필요한 처리 과정을 넣어줌으로써 원하는 처리를 진행 할 수 있다.
3. destroy() 
    - 필터 객체를 제거하고 사용하는 자원을 반환하기 위한 메소드. 웹 컨테이너가 1회 destroy()를 호출하여 필터 객체를 종료하면 이후에는 doFilter()에 의해 처리되지 않는다.

<br />


<div id="2"></div>

## 인터셉터(Interceptor)

요청에 대한 작업 전 / 후로 가로 챈다.

Dispatcher Servlet이 Controller를 호출하기 전 / 후에 인터셉터가 끼어들어 요청과 응답을 참조하거나 가공할 수 있는 기능을 제공한다.

웹 컨테이너에서 동작하는 필터와 달리 인터셉터는 스프링 컨텍스트에서 동작한다.

<img src="./images/Interceptor.png" alt="Interceptor" />

1. preHandle()
    - Controller가 호출되기 전에 실행된다.
    - 컨트롤러가 이전에 처리해야하는 전처리 작업이나 요청 정보를 가공하거나 추가하는 경우에 사용할 수 있다.
2. postHandle() 
    - Controller가 호출된 후에 실행된다. (View 랜더링 전)
    - 컨트롤러 이후에 처리해야하는 후 처리 작업이 있을 때 사용할 수 있다. 이 메소드는 컨트롤러가 반환하는 ModelAndView 타입의 정보가 제공되는데, 최근에는 JSON 형태로 데이터를 제공하는 RestAPI 기반의 컨트롤러(@RestController)를 만들면서 자주 사용되지는 않음
3. afterCompletion()
    - 모든 뷰에서 최종 결과를 생성하는 일을 포함해 모든 작업이 완료된 후에 실행된다. (View 랜더링 후) 요청 처리 중에 사용한 리소스를 반환할 때 사용할 수 있다.


<br />

<div id="3"></div>

## 필터와 인터셉터 차이

1. Request, Response 객체 조작 가능 여부

필터는 Request와 Response를 조작할 수 있지만, 인터셉터는 조작이 불가능하다. 
필터가 다음 필터를 호출하기 위해서는 필터 채이닝(다음 필터 호출)을 해주어야한다. 
이떄 Request, Response 객체를 넘겨주므로 우리가 원하는 Request, Response 객체를 넣어줄 수 있다.

<img src="./images/Filter_control.png" alt="Filter_control" />

인터셉트는 디스패처 서블릿이 여러 인터셉터 목록을 가지고 있고, 순차적으로 실행시킨다.
그리고 true 를 반환하면 다음 인터셉터가 실행되거나 컨트롤러로 요청이 전달되며, false가 반환되면 요청이 중단된다. 그러므로 다른 Request , Response 객체를 넘겨줄 수 없다.

<img src="./images/Interceptor_control.png" alt="Interceptor_control" />

<br>

<div id="4"></div>

## 필터와 인터셉터 사용 사례

필터
1. 보안 및 인증/인가 관련 작업
2. 모든 요청에 대한 로깅 또는 검사
3. 이미지 / 데이터 압축 및 문자열 인코딩
4. Spring과 분리되어야 하는 기능

 - 스프링과 무관하게 전역적으로 처리해야 하는 작업들을 처리할 수 있다.
 - 필터는 이미지나 데이터의 압축, 문자열 인코딩과 같이 웹 어플리케이션에 전반적으로 사용되는 기능을 구현하기에 적당하다.
 - 인터셉터보다 앞단에서 동작하기 때문에 보안 검사를 하여 올바른 요청이 아닐 경우 차단할 수 있다. 그러면 스프링 컨테이너까지 요청이 전달되지 못하고 차단되므로 안전성을 높일 수 있다.


인터셉터
1. 세부적인 보안 및 인증 / 인가 공통 작업
2. API 호출에 대한 로깅 또는 검사
3. Controller로 넘겨주는 정보(데이터)의 가공

인터셉터에서는 클라이언트의 요청과 관련되어 전역적으로 처리해야 하는 작업들을 처리할 수 있다. 
필터와 다르게 HttpServletRequest나 HttpServletResponse 등과 같은 객체를 제공받으므로 객체 자체를 조작할 수는 없다.
대신 해당 객체가 내부적으로 갖는 값은 조작할 수 있으므로 컨트롤러로 넘겨주기 위한 정보를 가공하기에 용이하다.

정리

<img src="./images/Filter_Interceptor.png" alt="Filter_Interceptor" /> 

필터와 인터셉터 모두 비즈니스 로직과 분리되어 특정 요구사항(보안, 인증, 인코딩 등)을 만족시켜야 할 때 적용한다.

필터는 특정 요청과 컨트롤러에 관계없이 전역적으로 처리해야 하는 작업이나 
웹 어플리케이션에 전반적으로 사용되는 기능을 구현할 때 적용하고,

인터셉터는 클라이언트의 요청과 관련된 작업에 대해 추가적인 요구사항을 만족해야 할 때 적용한다.